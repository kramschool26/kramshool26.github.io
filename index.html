<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Шкільний розклад — перегляд</title>
<style>
  :root{--blue:#2f80ed;--bg:#f7f9fc;}
  html,body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:#222}
  .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
  header{display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between}
  h1{font-size:22px;margin:0}
  select{padding:8px 12px;border:1px solid #cdd6e1;border-radius:8px;background:#fff;font-size:14px}
  .table-wrap{overflow:auto;margin-top:12px;border:1px solid #e4e9f0;border-radius:12px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.04)}
  table{width:100%;border-collapse:collapse;font-size:14px}
  th,td{border-bottom:1px solid #eef2f7;padding:10px;text-align:center}
  thead th{position:sticky;top:0;background:var(--blue);color:#fff;z-index:1}
  tbody tr:nth-child(odd){background:#fbfdff}
  td.period{white-space:nowrap;font-weight:600}
  footer{margin:18px 0 8px;color:#6b7686;font-size:12px;text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Шкільний розклад — перегляд</h1>
    <label>Клас: <select id="classSelect"></select></label>
  </header>

  <div class="table-wrap">
    <table id="tbl">
      <thead>
        <tr>
          <th style="width:56px">№</th>
          <th style="width:150px">Час</th>
          <th>Понеділок</th>
          <th>Вівторок</th>
          <th>Середа</th>
          <th>Четвер</th>
          <th>П'ятниця</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <footer>Щоб оновити розклад для всіх: відредагуйте файл <code>data/rozklad.csv</code> у репозиторії і натисніть Commit.</footer>
</div>

<script>
async function loadCSV(url){
  const res = await fetch(url + '?_=' + Date.now());
  if(!res.ok) throw new Error('Не вдалося завантажити CSV');
  const text = await res.text();
  return parseCSV(text);
}

function parseCSV(text){
  const rows = text.split(/\r?\n/).filter(Boolean).map(r => r.split(/,(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/).map(c => c.replace(/^"|"$/g,'')));
  const headers = rows.shift();
  return rows.map(r => Object.fromEntries(headers.map((h,i)=>[h, r[i] ?? ""])));
}

function unique(list){ return Array.from(new Set(list)); }

function buildClassOptions(data){
  const sel = document.getElementById('classSelect');
  sel.innerHTML = '';
  unique(data.map(r => r.Class)).forEach(cls => {
    const opt = document.createElement('option'); opt.value=cls; opt.textContent=cls;
    sel.appendChild(opt);
  });
  return sel;
}

function renderTable(data, cls){
  const tbody = document.querySelector('#tbl tbody');
  tbody.innerHTML='';
  const rows = data.filter(r => r.Class === cls).sort((a,b)=>+a.Period-+b.Period);
  rows.forEach(r => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td class="period">${r.Period}</td>
                    <td class="period">${r.Time}</td>
                    <td>${r.Mon||''}</td>
                    <td>${r.Tue||''}</td>
                    <td>${r.Wed||''}</td>
                    <td>${r.Thu||''}</td>
                    <td>${r.Fri||''}</td>`;
    tbody.appendChild(tr);
  });
}

(async ()=>{
  try{
    const data = await loadCSV('data/rozklad.csv');
    const sel = buildClassOptions(data);
    sel.onchange = () => renderTable(data, sel.value);
    sel.value = sel.options[0]?.value || '';
    if(sel.value) renderTable(data, sel.value);
  }catch(e){
    alert('Помилка завантаження розкладу: ' + e.message + '\nПеревірте, що файл data/rozklad.csv існує у репозиторії.');
  }
})();
</script>
</body>
</html>
