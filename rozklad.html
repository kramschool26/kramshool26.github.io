<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>Шкільний Розклад App</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; text-align: center; padding: 8px; }
    th { background-color: #2f80ed; color: white; }
    td input { width: 100%; border: none; text-align: center; }
    select, button { margin: 5px; padding: 5px; }
    .color-Математика { background-color: #f4cccc; }
    .color-Українська { background-color: #b6d7a8; }
    .color-Англійська { background-color: #cfe2f3; }
    .color-Природознавство { background-color: #ffe599; }
    .color-Читання { background-color: #f9cb9c; }
  </style>
</head>
<body>
  <h1>Шкільний Розклад App</h1>
  <label>Розклад для класу:
    <select id="classSelect"></select>
  </label>
  <label>Розклад для вчителя:
    <select id="teacherSelect">
      <option>Оберіть вчителя</option>
    </select>
  </label>

  <table id="scheduleTable">
    <thead>
      <tr>
        <th>Годи</th>
        <th>Понеділок</th>
        <th>Вівторок</th>
        <th>Середа</th>
        <th>Четвер</th>
        <th>П'ятниця</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button onclick="copyDay()">Копіювати з дня</button>
  <button onclick="savePDF()">Зберегти в PDF</button>
  <button onclick="saveCSV()">Зберегти в CSV</button>

  <p><em>Копіювання підгруп: Натисніть на комірку та оберіть підгрупу (1 підгр2, тд. і т.д.)</em></p>

  <script>
    const класList = [
      '1','2-А','2-Б','3-А','3-Б','4-А','4-Б','5-А','5-Б','5-В','6-А','6-Б','6-В','6-Г',
      '7-А','7-Б','7-В','8-А','8-Б','8-В','9-А','9-Б','9-В'
    ];
    const subjectsColor = {
      "Математика": "color-Математика",
      "Українська мова": "color-Українська",
      "Українська": "color-Українська",
      "Англійська мова": "color-Англійська",
      "Природознавство": "color-Природознавство",
      "Читання": "color-Читання"
    };
    const уроки = ["08:30", "09:25", "10:50", "11:25", "12:00", "13:10", "14:05", "15:00"];

    const tableBody = document.querySelector("#scheduleTable tbody");
    const classSelect = document.getElementById("classSelect");

    класList.forEach(cls => {
      const opt = document.createElement("option");
      opt.value = cls;
      opt.textContent = cls;
      classSelect.appendChild(opt);
    });

    function loadSchedule() {
      tableBody.innerHTML = "";
      уроки.forEach((time, row) => {
        const tr = document.createElement("tr");
        const th = document.createElement("th");
        th.textContent = time;
        tr.appendChild(th);

        for (let i = 0; i < 5; i++) {
          const td = document.createElement("td");
          const input = document.createElement("input");
          input.dataset.day = i;
          input.dataset.row = row;
          input.addEventListener("input", saveData);
          td.appendChild(input);
          tr.appendChild(td);
        }
        tableBody.appendChild(tr);
      });

      const saved = JSON.parse(localStorage.getItem("rozklad_" + classSelect.value)) || {};
      Object.entries(saved).forEach(([key, val]) => {
        const [row, day] = key.split("_");
        const input = tableBody.rows[row].cells[+day + 1].querySelector("input");
        input.value = val;
        input.parentElement.className = subjectsColor[val] || "";
      });
    }

    function saveData(e) {
      const inputs = tableBody.querySelectorAll("input");
      const data = {};
      inputs.forEach(input => {
        const val = input.value.trim();
        const key = `${input.dataset.row}_${input.dataset.day}`;
        if (val) {
          data[key] = val;
        }
      });
      localStorage.setItem("rozklad_" + classSelect.value, JSON.stringify(data));
      e.target.parentElement.className = subjectsColor[e.target.value] || "";
    }

    classSelect.addEventListener("change", loadSchedule);
    window.onload = loadSchedule;

    function copyDay() {
      const dayFrom = prompt("Копіювати з якого дня? (0=Пн ... 4=Пт)");
      if (dayFrom === null || dayFrom < 0 || dayFrom > 4) return;
      for (let row = 0; row < уроки.length; row++) {
        const fromInput = tableBody.rows[row].cells[+dayFrom + 1].querySelector("input");
        for (let d = 0; d < 5; d++) {
          if (d !== +dayFrom) {
            const toInput = tableBody.rows[row].cells[d + 1].querySelector("input");
            toInput.value = fromInput.value;
            toInput.parentElement.className = subjectsColor[fromInput.value] || "";
          }
        }
      }
      saveData({ target: tableBody.rows[0].cells[1].querySelector("input") });
    }

    function saveCSV() {
      let csv = "Година,Пн,Вт,Ср,Чт,Пт
";
      for (let row = 0; row < уроки.length; row++) {
        csv += уроки[row];
        for (let d = 0; d < 5; d++) {
          const val = tableBody.rows[row].cells[d + 1].querySelector("input").value;
          csv += "," + val;
        }
        csv += "
";
      }
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `Розклад_${classSelect.value}.csv`;
      a.click();
      URL.revokeObjectURL(url);
    }

    function savePDF() {
      window.print(); // Спрощена PDF-функція
    }
  </script>
</body>
</html>
